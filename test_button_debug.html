<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ø¯Ú©Ù…Ù‡ Ø§ÙØ²ÙˆØ¯Ù†</title>
    <script src="https://cdn.jsdelivr.net/npm/persian-date@latest/dist/persian-date.min.js"></script>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .form-group { margin: 15px 0; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; }
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .hidden { display: none; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 8px; text-align: right; border-bottom: 1px solid #ddd; }
        th { background: #f8f9fa; }
        .toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #28a745; color: white; padding: 10px 20px; border-radius: 5px; z-index: 1000; }
        .error { background: #dc3545 !important; }
        .log { background: #e9ecef; padding: 10px; margin: 10px 0; border-radius: 5px; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ØªØ³Øª Ø¯Ú©Ù…Ù‡ Ø§ÙØ²ÙˆØ¯Ù†</h1>
        
        <div class="log" id="debug-log">Ø¢Ù…Ø§Ø¯Ù‡...</div>
        
        <div class="form-group">
            <label>Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„</label>
            <input type="text" id="test-name" value="Ú©ÙØ´ ØªØ³Øª">
        </div>
        
        <div class="form-group">
            <label>Ø±Ù†Ú¯</label>
            <input type="text" id="test-color" value="Ù…Ø´Ú©ÛŒ">
        </div>
        
        <div class="form-group">
            <label>ØªØ¹Ø¯Ø§Ø¯</label>
            <input type="number" id="test-quantity" value="1" min="1">
        </div>
        
        <button class="btn btn-success" onclick="testAdd()">ğŸ§ª ØªØ³Øª Ø§ÙØ²ÙˆØ¯Ù†</button>
        <button class="btn btn-danger" onclick="checkFunctions()">ğŸ” Ø¨Ø±Ø±Ø³ÛŒ ØªÙˆØ§Ø¨Ø¹</button>
        
        <div id="temp-list" class="hidden" style="margin-top: 20px;">
            <h3>Ù„ÛŒØ³Øª Ù…ÙˆÙ‚Øª:</h3>
            <table>
                <thead>
                    <tr><th>Ù†Ø§Ù…</th><th>Ø±Ù†Ú¯</th><th>ØªØ¹Ø¯Ø§Ø¯</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr>
                </thead>
                <tbody id="temp-body"></tbody>
            </table>
        </div>
    </div>

    <script>
        let products = [];
        let tempEntryItems = [];
        
        function log(message) {
            console.log(message);
            document.getElementById('debug-log').innerHTML += '<br>' + message;
        }
        
        function showToast(message, type = 'success') {
            log('Toast: ' + message);
            const toast = document.createElement('div');
            toast.className = 'toast';
            if (type === 'error') toast.classList.add('error');
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        
        function formatPersianDate(dateString) {
            if (!dateString) return new Date().toLocaleDateString('fa-IR');
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('fa-IR');
            } catch (e) {
                log('Ø®Ø·Ø§ Ø¯Ø± formatPersianDate: ' + e.message);
                return dateString;
            }
        }
        
        function updateEntryProductSelect() {
            log('ØªØ§Ø¨Ø¹ updateEntryProductSelect Ø§Ø¬Ø±Ø§ Ø´Ø¯');
        }
        
        function clearEntryForm() {
            document.getElementById('test-name').value = '';
            document.getElementById('test-color').value = '';
            document.getElementById('test-quantity').value = '1';
            log('ØªØ§Ø¨Ø¹ clearEntryForm Ø§Ø¬Ø±Ø§ Ø´Ø¯');
        }
        
        function renderTempEntryItems() {
            log('ØªØ§Ø¨Ø¹ renderTempEntryItems Ø§Ø¬Ø±Ø§ Ø´Ø¯');
            const tbody = document.getElementById('temp-body');
            if (!tbody) {
                log('ERROR: tbody not found!');
                return;
            }
            
            tbody.innerHTML = tempEntryItems.map((item, index) => `
                <tr>
                    <td>${item.name}</td>
                    <td>${item.color}</td>
                    <td>${item.quantity}</td>
                    <td><button onclick="removeItem(${index})">Ø­Ø°Ù</button></td>
                </tr>
            `).join('');
        }
        
        function removeItem(index) {
            log('Ø­Ø°Ù Ø¢ÛŒØªÙ…: ' + index);
            tempEntryItems.splice(index, 1);
            renderTempEntryItems();
            
            if (tempEntryItems.length === 0) {
                document.getElementById('temp-list').classList.add('hidden');
            }
        }
        
        function testAdd() {
            log('=== Ø´Ø±ÙˆØ¹ ØªØ§Ø¨Ø¹ testAdd ===');
            
            const name = document.getElementById('test-name').value.trim();
            const color = document.getElementById('test-color').value.trim();
            const quantity = parseInt(document.getElementById('test-quantity').value);
            
            log('Ù…Ù‚Ø§Ø¯ÛŒØ±: name=' + name + ', color=' + color + ', quantity=' + quantity);
            
            if (!name || !color || quantity <= 0) {
                showToast('Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯', 'error');
                log('ERROR: ÙÛŒÙ„Ø¯Ù‡Ø§ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª');
                return;
            }
            
            log('ÙÛŒÙ„Ø¯Ù‡Ø§ ØµØ­ÛŒØ­ Ø§Ø³Øª');
            
            // Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ¬ÙˆØ¯
            let product = products.find(p => p.name === name && p.color === color);
            log('Ù…Ø­ØµÙˆÙ„ ÛŒØ§ÙØª Ø´Ø¯: ' + (product ? 'Ø¨Ù„Ù‡' : 'Ø®ÛŒØ±'));
            
            if (!product) {
                product = {
                    id: Date.now(),
                    name: name,
                    color: color,
                    entry: 0,
                    sales151: 0,
                    sales168: 0
                };
                products.push(product);
                log('Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
            }
            
            // Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ù„ÛŒØ³Øª Ù…ÙˆÙ‚Øª
            tempEntryItems.push({
                productId: product.id,
                name: name,
                color: color,
                quantity: quantity,
                invoiceDate: new Date().toISOString().split('T')[0]
            });
            
            log('Ø¢ÛŒØªÙ… Ø¨Ù‡ Ù„ÛŒØ³Øª Ù…ÙˆÙ‚Øª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯. ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„: ' + tempEntryItems.length);
            
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
            clearEntryForm();
            updateEntryProductSelect();
            
            // Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª Ù…ÙˆÙ‚Øª
            document.getElementById('temp-list').classList.remove('hidden');
            renderTempEntryItems();
            
            showToast('Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ Ù„ÛŒØ³Øª ÙˆØ±ÙˆØ¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
            log('=== Ù¾Ø§ÛŒØ§Ù† ØªØ§Ø¨Ø¹ testAdd ===');
        }
        
        function checkFunctions() {
            log('=== Ø¨Ø±Ø±Ø³ÛŒ ØªÙˆØ§Ø¨Ø¹ ===');
            log('ØªØ§Ø¨Ø¹ showToast: ' + typeof showToast);
            log('ØªØ§Ø¨Ø¹ formatPersianDate: ' + typeof formatPersianDate);
            log('ØªØ§Ø¨Ø¹ updateEntryProductSelect: ' + typeof updateEntryProductSelect);
            log('ØªØ§Ø¨Ø¹ clearEntryForm: ' + typeof clearEntryForm);
            log('ØªØ§Ø¨Ø¹ renderTempEntryItems: ' + typeof renderTempEntryItems);
            log('ØªØ§Ø¨Ø¹ testAdd: ' + typeof testAdd);
            log('Ù…ØªØºÛŒØ± products: ' + products.length);
            log('Ù…ØªØºÛŒØ± tempEntryItems: ' + tempEntryItems.length);
        }
        
        // ØªØ³Øª Ø®ÙˆØ¯Ú©Ø§Ø±
        window.onload = function() {
            log('ØµÙØ­Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯');
            checkFunctions();
            log('ØªØ³Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ø¬Ø±Ø§ Ø´Ø¯');
        };
    </script>
</body>
</html>