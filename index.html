<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÛŒØ³ØªÙ… Ø§Ù†Ø¨Ø§Ø±Ø¯Ø§Ø±ÛŒ Ú©ÙØ´ Ø²Ù†Ø§Ù†Ù‡ - Ø³Ø§Ø¯Ù‡</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .data-management {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .sync-status {
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .sync-status.online {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .sync-status.offline {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .backup-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .header {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-size: 1.1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .tab.active {
            background: #667eea;
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .tab:hover:not(.active) {
            background: #f0f0f0;
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .form-section {
            background: #f8f9ff;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 2px solid #e8eaff;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: flex;
            gap: 20px;
            align-items: end;
        }

        .form-row .form-group {
            flex: 1;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(23, 162, 184, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 25px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .table th, .table td {
            padding: 15px;
            text-align: right;
            border-bottom: 1px solid #e0e0e0;
        }

        .table th {
            background: #f8f9ff;
            font-weight: 600;
            color: #555;
            font-size: 0.95rem;
        }

        .table tbody tr:hover {
            background: #f8f9ff;
        }

        .table tbody tr:last-child td {
            border-bottom: none;
        }

        .stock-low {
            color: #dc3545;
            font-weight: 600;
        }

        .stock-ok {
            color: #28a745;
            font-weight: 600;
        }

        .invoice-list {
            display: grid;
            gap: 20px;
            margin-top: 25px;
        }

        .invoice-card {
            background: #f8f9ff;
            border: 2px solid #e8eaff;
            border-radius: 12px;
            padding: 20px;
        }

        .invoice-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
            gap: 15px;
        }

        .invoice-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .invoice-date {
            color: #666;
            font-size: 0.9rem;
        }

        .invoice-items {
            font-size: 0.9rem;
        }

        .invoice-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .invoice-item:last-child {
            border-bottom: none;
        }

        .invoice-item-view {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .invoice-item-edit {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
        }

        .invoice-item-edit input {
            width: 80px;
            padding: 5px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }

        .edit-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }

        .hidden {
            display: none !important;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            background: #dc3545;
        }

        .toast.info {
            background: #17a2b8;
        }

        .quick-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .tabs {
                flex-direction: column;
            }

            .form-row {
                flex-direction: column;
            }

            .table-container {
                font-size: 0.9rem;
            }

            .quick-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Ø³ÛŒØ³ØªÙ… Ø§Ù†Ø¨Ø§Ø±Ø¯Ø§Ø±ÛŒ Ú©ÙØ´ Ø²Ù†Ø§Ù†Ù‡</h1>
            <p>Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ±ÙˆØ¯ÛŒ Ùˆ ÙØ±ÙˆØ´ Ù…Ø­ØµÙˆÙ„Ø§Øª</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('entry')">ğŸ“¦ ÙˆØ±ÙˆØ¯ÛŒ</button>
            <button class="tab" onclick="showTab('sales151')">ğŸª ÙØ±ÙˆØ´ Û±ÛµÛ±</button>
            <button class="tab" onclick="showTab('sales168')">ğŸª ÙØ±ÙˆØ´ Û±Û¶Û¸</button>
            <button class="tab" onclick="showTab('inventory')">ğŸ“Š Ù…ÙˆØ¬ÙˆØ¯ÛŒ</button>
            <button class="tab" onclick="showTab('data-management')">â˜ï¸ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡</button>
        </div>

        <!-- ÙˆØ±ÙˆØ¯ÛŒ Tab -->
        <div id="entry" class="tab-content active">
            <h2 class="section-title">ğŸ“¦ Ø«Ø¨Øª ÙˆØ±ÙˆØ¯ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª</h2>
            
            <div class="form-section">
                <div class="form-row">
                    <div class="form-group">
                        <label>Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø­ØµÙˆÙ„</label>
                        <select id="entry-product-select" onchange="onEntryProductSelect()">
                            <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ¬ÙˆØ¯ ÛŒØ§ Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯</option>
                            <option value="new">â• Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„</label>
                        <input type="text" id="entry-product-name" placeholder="Ù…Ø«Ø§Ù„: Ú©ÙØ´ Ø§Ø³Ù¾ÙˆØ±Øª">
                    </div>
                    <div class="form-group">
                        <label>Ø±Ù†Ú¯</label>
                        <input type="text" id="entry-product-color" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø´Ú©ÛŒ">
                    </div>
                    <div class="form-group">
                        <label>ØªØ¹Ø¯Ø§Ø¯</label>
                        <input type="number" id="entry-quantity" min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label>ØªØ§Ø±ÛŒØ® ÙØ§Ú©ØªÙˆØ±</label>
                        <input type="date" id="entry-invoice-date">
                    </div>
                    <div class="form-group" style="width: auto;">
                        <label>&nbsp;</label>
                        <button class="btn btn-success" onclick="addEntry()">â• Ø§ÙØ²ÙˆØ¯Ù†</button>
                    </div>
                </div>
            </div>

            <div id="entry-temp-list" class="hidden">
                <h3>Ù…Ø­ØµÙˆÙ„Ø§Øª Ù…ÙˆÙ‚Øª ÙˆØ±ÙˆØ¯ÛŒ</h3>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„</th>
                                <th>Ø±Ù†Ú¯</th>
                                <th>ØªØ¹Ø¯Ø§Ø¯</th>
                                <th>ØªØ§Ø±ÛŒØ® ÙØ§Ú©ØªÙˆØ±</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="entry-temp-body"></tbody>
                    </table>
                </div>
                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn btn-success" onclick="saveEntry()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ ÙØ§Ú©ØªÙˆØ± ÙˆØ±ÙˆØ¯ÛŒ</button>
                    <button class="btn btn-secondary" onclick="cancelEntry()">âŒ Ù„ØºÙˆ</button>
                </div>
            </div>

            <h3 style="margin-top: 30px;">ğŸ“‹ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ</h3>
            <div id="entry-invoices" class="invoice-list"></div>
        </div>

        <!-- ÙØ±ÙˆØ´ Û±ÛµÛ± Tab -->
        <div id="sales151" class="tab-content">
            <h2 class="section-title">ğŸª ÙØ±ÙˆØ´ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Û±ÛµÛ±</h2>
            
            <div class="form-section">
                <div class="form-row">
                    <div class="form-group">
                        <label>Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„</label>
                        <select id="sales151-product" onchange="updateStock151()">
                            <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø­ØµÙˆÙ„</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ</label>
                        <input type="text" id="stock151" readonly placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>ØªØ¹Ø¯Ø§Ø¯ ÙØ±ÙˆØ®ØªÙ‡</label>
                        <input type="number" id="sales151-quantity" min="1" value="1">
                    </div>
                    <div class="form-group" style="width: auto;">
                        <label>&nbsp;</label>
                        <button class="btn btn-success" onclick="addSales151()">â• Ø§ÙØ²ÙˆØ¯Ù†</button>
                    </div>
                </div>
            </div>

            <div id="sales151-temp-list" class="hidden">
                <h3>Ù…Ø­ØµÙˆÙ„Ø§Øª Ù…ÙˆÙ‚Øª ÙØ±ÙˆØ´ Û±ÛµÛ±</h3>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„</th>
                                <th>Ø±Ù†Ú¯</th>
                                <th>ØªØ¹Ø¯Ø§Ø¯</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="sales151-temp-body"></tbody>
                    </table>
                </div>
                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn btn-success" onclick="saveSales151()">ğŸ’¾ Ø«Ø¨Øª ÙØ±ÙˆØ´</button>
                    <button class="btn btn-secondary" onclick="cancelSales151()">âŒ Ù„ØºÙˆ</button>
                </div>
            </div>

            <h3 style="margin-top: 30px;">ğŸ“‹ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ÛŒ ÙØ±ÙˆØ´ Û±ÛµÛ±</h3>
            <div id="sales151-invoices" class="invoice-list"></div>
        </div>

        <!-- ÙØ±ÙˆØ´ Û±Û¶Û¸ Tab -->
        <div id="sales168" class="tab-content">
            <h2 class="section-title">ğŸª ÙØ±ÙˆØ´ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Û±Û¶Û¸</h2>
            
            <div class="form-section">
                <div class="form-row">
                    <div class="form-group">
                        <label>Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„</label>
                        <select id="sales168-product" onchange="updateStock168()">
                            <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø­ØµÙˆÙ„</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ</label>
                        <input type="text" id="stock168" readonly placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>ØªØ¹Ø¯Ø§Ø¯ ÙØ±ÙˆØ®ØªÙ‡</label>
                        <input type="number" id="sales168-quantity" min="1" value="1">
                    </div>
                    <div class="form-group" style="width: auto;">
                        <label>&nbsp;</label>
                        <button class="btn btn-success" onclick="addSales168()">â• Ø§ÙØ²ÙˆØ¯Ù†</button>
                    </div>
                </div>
            </div>

            <div id="sales168-temp-list" class="hidden">
                <h3>Ù…Ø­ØµÙˆÙ„Ø§Øª Ù…ÙˆÙ‚Øª ÙØ±ÙˆØ´ Û±Û¶Û¸</h3>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„</th>
                                <th>Ø±Ù†Ú¯</th>
                                <th>ØªØ¹Ø¯Ø§Ø¯</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="sales168-temp-body"></tbody>
                    </table>
                </div>
                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn btn-success" onclick="saveSales168()">ğŸ’¾ Ø«Ø¨Øª ÙØ±ÙˆØ´</button>
                    <button class="btn btn-secondary" onclick="cancelSales168()">âŒ Ù„ØºÙˆ</button>
                </div>
            </div>

            <h3 style="margin-top: 30px;">ğŸ“‹ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ÛŒ ÙØ±ÙˆØ´ Û±Û¶Û¸</h3>
            <div id="sales168-invoices" class="invoice-list"></div>
        </div>

        <!-- Ù…ÙˆØ¬ÙˆØ¯ÛŒ Tab -->
        <div id="inventory" class="tab-content">
            <h2 class="section-title">ğŸ“Š Ú¯Ø²Ø§Ø±Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ù†Ø¨Ø§Ø±</h2>
            
            <div class="quick-actions">
                <button class="btn btn-primary" onclick="showAddProduct()">â• Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯</button>
                <button class="btn btn-secondary" onclick="refreshInventory()">ğŸ”„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</button>
            </div>

            <div id="add-product-form" class="form-section hidden">
                <h3>Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„</label>
                        <input type="text" id="new-product-name" placeholder="Ù…Ø«Ø§Ù„: Ú©ÙØ´ Ø§Ø³Ù¾ÙˆØ±Øª">
                    </div>
                    <div class="form-group">
                        <label>Ø±Ù†Ú¯</label>
                        <input type="text" id="new-product-color" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø´Ú©ÛŒ">
                    </div>
                    <div class="form-group" style="width: auto;">
                        <label>&nbsp;</label>
                        <button class="btn btn-success" onclick="saveNewProduct()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡</button>
                    </div>
                    <div class="form-group" style="width: auto;">
                        <label>&nbsp;</label>
                        <button class="btn btn-secondary" onclick="hideAddProduct()">âŒ Ù„ØºÙˆ</button>
                    </div>
                </div>
            </div>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="total-products">0</div>
                    <div class="stat-label">ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„Ø§Øª</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-stock">0</div>
                    <div class="stat-label">Ù…Ø¬Ù…ÙˆØ¹ Ù…ÙˆØ¬ÙˆØ¯ÛŒ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="low-stock">0</div>
                    <div class="stat-label">Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ù…</div>
                </div>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„</th>
                            <th>Ø±Ù†Ú¯</th>
                            <th>ÙˆØ±ÙˆØ¯ÛŒ Ú©Ù„</th>
                            <th>ÙØ±ÙˆØ´ Û±ÛµÛ±</th>
                            <th>ÙØ±ÙˆØ´ Û±Û¶Û¸</th>
                            <th>Ù…ÙˆØ¬ÙˆØ¯ÛŒ</th>
                        </tr>
                    </thead>
                    <tbody id="inventory-body"></tbody>
                </table>
            </div>
        </div>

        <div id="data-management" class="tab-content">
            <h2 class="section-title">â˜ï¸ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡ Ùˆ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ</h2>
            
            <div class="data-management">
                <div id="sync-status" class="sync-status offline">
                    ÙˆØ¶Ø¹ÛŒØª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ: Ø¢ÙÙ„Ø§ÛŒÙ† (ÙÙ‚Ø· LocalStorage)
                </div>
                
                <div class="backup-controls">
                    <button class="btn btn-primary" onclick="exportData()">ğŸ“¤ Ø®Ø±ÙˆØ¬ÛŒ Ú¯Ø±ÙØªÙ† Ø§Ø² Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</button>
                    <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importData(this)">
                    <button class="btn btn-secondary" onclick="document.getElementById('import-file').click()">ğŸ“¥ ÙˆØ±ÙˆØ¯ÛŒ Ú¯Ø±ÙØªÙ† Ø§Ø² ÙØ§ÛŒÙ„</button>
                    <button class="btn btn-info" onclick="setupCloudSync()">â˜ï¸ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø§Ø¨Ø±ÛŒ</button>
                    <button class="btn btn-warning" onclick="createBackup()">ğŸ’¾ Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù…Ø­Ù„ÛŒ</button>
                    <button class="btn btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</button>
                </div>
            </div>

            <div class="data-management">
                <h3>ğŸ” Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ…</h3>
                <div class="system-info">
                    <p><strong>ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„Ø§Øª:</strong> <span id="total-products-info">0</span></p>
                    <p><strong>ØªØ¹Ø¯Ø§Ø¯ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ:</strong> <span id="entry-invoices-count">0</span></p>
                    <p><strong>ØªØ¹Ø¯Ø§Ø¯ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ÛŒ ÙØ±ÙˆØ´ 151:</strong> <span id="sales151-invoices-count">0</span></p>
                    <p><strong>ØªØ¹Ø¯Ø§Ø¯ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ÛŒ ÙØ±ÙˆØ´ 168:</strong> <span id="sales168-invoices-count">0</span></p>
                    <p><strong>Ø¢Ø®Ø±ÛŒÙ† Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ:</strong> <span id="last-save-time">Ù†Ø§Ù…Ø´Ø®Øµ</span></p>
                    <p><strong>ÙØ¶Ø§ÛŒ Ø§Ø´ØºØ§Ù„ Ø´Ø¯Ù‡:</strong> <span id="storage-size">0 KB</span></p>
                </div>
            </div>

            <div class="data-management">
                <h3>ğŸŒ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø§Ø¨Ø±ÛŒ</h3>
                <div class="cloud-options">
                    <button class="btn btn-primary" onclick="setupFirebase()">ğŸ”¥ Firebase (Ú¯ÙˆÚ¯Ù„)</button>
                    <button class="btn btn-success" onclick="setupSupabase()">âš¡ Supabase</button>
                    <button class="btn btn-dark" onclick="setupGitHub()">ğŸ“± GitHub Gist</button>
                    <button class="btn btn-info" onclick="setupLocalStorageBackup()">ğŸ’¾ LocalStorage Enhanced</button>
                </div>
                <p style="margin-top: 15px; color: #666; font-size: 0.9rem;">
                    ğŸ’¡ <strong>Ø±Ø§Ù‡Ù†Ù…Ø§:</strong> Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¨ÛŒÙ† Ø¯Ø³ØªÛŒØ§Ù‡â€ŒÙ‡Ø§ØŒ ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯. 
                    Firebase Ùˆ Supabase Ø±Ø§ÛŒÚ¯Ø§Ù† Ù‡Ø³ØªÙ†Ø¯ Ùˆ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¯Ø§Ø±Ù†Ø¯.
                </p>
            </div>

            <!-- Ø¨Ø®Ø´ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ú¯ÛŒØª Ù‡Ø§Ø¨ -->
            <div class="data-management" id="github-sync-section" style="display: none;">
                <h3>ğŸ”— Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ GitHub</h3>
                <p>Ù„Ø·ÙØ§Ù‹ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ GitHub Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯:</p>
                <div class="cloud-options">
                    <button class="btn btn-info" onclick="testGitHubConnectionWithSavedConfig()">ğŸ”„ ØªØ³Øª Ø§ØªØµØ§Ù„ GitHub</button>
                    <button class="btn btn-primary" onclick="syncToGitHub()">â¬†ï¸ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ GitHub</button>
                    <button class="btn btn-success" onclick="syncFromGitHub()">â¬‡ï¸ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø² GitHub</button>
                </div>
                <p style="margin-top: 15px; color: #666; font-size: 0.9rem;">
                    ğŸ’¡ <strong>Ù†Ú©ØªÙ‡:</strong> "ØªØ³Øª Ø§ØªØµØ§Ù„" ÙˆØ¶Ø¹ÛŒØª GitHub Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. 
                    Ø§Ú¯Ø± Ø®Ø·Ø§ÛŒ 401 Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒØ¯ØŒ Token Ø¬Ø¯ÛŒØ¯ Ø¨Ø³Ø§Ø²ÛŒØ¯.
                </p>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ
        let products = JSON.parse(localStorage.getItem('products')) || [];
        let entryInvoices = JSON.parse(localStorage.getItem('entryInvoices')) || [];
        let salesInvoices151 = JSON.parse(localStorage.getItem('salesInvoices151')) || [];
        let salesInvoices168 = JSON.parse(localStorage.getItem('salesInvoices168')) || [];
        let tempEntryItems = [];
        let tempSales151Items = [];
        let tempSales168Items = [];
        let editingInvoice = null; // { type: 'entry'|'sales151'|'sales168', index: number }
        let currentAddTarget = null; // { type: 'entry'|'sales151'|'sales168', invoiceId: number }
        
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡
        let cloudSync = {
            enabled: false,
            provider: null, // 'firebase', 'supabase', 'github', 'localStorage'
            config: null,
            lastSync: null
        };
        let autoBackupConfig = {
            enabled: true,
            interval: 3600000, // Ù‡Ø± Ø³Ø§Ø¹Øª
            lastBackup: null
        };

        // ========== Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡ Ùˆ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ ==========
        
        // ØªØ§Ø¨Ø¹ Ø®Ø±ÙˆØ¬ÛŒ Ú¯Ø±ÙØªÙ† Ø§Ø² Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
        function exportData() {
            const data = {
                products: products,
                entryInvoices: entryInvoices,
                salesInvoices151: salesInvoices151,
                salesInvoices168: salesInvoices168,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'elishoes-backup-' + new Date().toISOString().split('T')[0] + '.json';
            link.click();
            
            showToast('ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯');
        }
        
        // ØªØ§Ø¨Ø¹ ÙˆØ±ÙˆØ¯ÛŒ Ú¯Ø±ÙØªÙ† Ø§Ø² ÙØ§ÛŒÙ„
        function importData(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø¨Ø§ Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
                        return;
                    }
                    
                    // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                    if (data.products && Array.isArray(data.products)) {
                        products = data.products;
                        localStorage.setItem('products', JSON.stringify(products));
                    }
                    
                    if (data.entryInvoices && Array.isArray(data.entryInvoices)) {
                        entryInvoices = data.entryInvoices;
                        localStorage.setItem('entryInvoices', JSON.stringify(entryInvoices));
                    }
                    
                    if (data.salesInvoices151 && Array.isArray(data.salesInvoices151)) {
                        salesInvoices151 = data.salesInvoices151;
                        localStorage.setItem('salesInvoices151', JSON.stringify(salesInvoices151));
                    }
                    
                    if (data.salesInvoices168 && Array.isArray(data.salesInvoices168)) {
                        salesInvoices168 = data.salesInvoices168;
                        localStorage.setItem('salesInvoices168', JSON.stringify(salesInvoices168));
                    }
                    
                    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
                    refreshInventory();
                    renderEntryInvoices();
                    renderSales151Invoices();
                    renderSales168Invoices();
                    updateSystemInfo();
                    
                    showToast('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù†Ø¯');
                    input.value = ''; // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
                    
                } catch (error) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„:', error);
                    showToast('Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„. Ù„Ø·ÙØ§Ù‹ ÙØ±Ù…Øª ØµØ­ÛŒØ­ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.', 'error');
                }
            };
            reader.readAsText(file);
        }
        
        // ØªÙˆØ§Ø¨Ø¹ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ
        function getInventory() {
            return JSON.parse(localStorage.getItem('products')) || [];
        }
        
        function getSales151() {
            return JSON.parse(localStorage.getItem('entryInvoices')) || [];
        }
        
        function getSales168() {
            return JSON.parse(localStorage.getItem('salesInvoices151')) || [];
        }
        
        function getAllInvoices() {
            const entryInvoices = JSON.parse(localStorage.getItem('entryInvoices')) || [];
            const sales151 = JSON.parse(localStorage.getItem('salesInvoices151')) || [];
            const sales168 = JSON.parse(localStorage.getItem('salesInvoices168')) || [];
            
            return {
                entryInvoices: entryInvoices,
                sales151: sales151,
                sales168: sales168
            };
        }
        
        // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¯Ø§Ø¯Ù‡ Ø§Ø² Ú¯ÛŒØª Ù‡Ø§Ø¨
        function restoreFromData(data) {
            // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ù†Ø¨Ø§Ø±
            if (data.inventory && Array.isArray(data.inventory)) {
                localStorage.setItem('products', JSON.stringify(data.inventory));
                products = data.inventory;
            }
            
            // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ÛŒ ÙˆØ±ÙˆØ¯
            if (data.sales151 && Array.isArray(data.sales151)) {
                localStorage.setItem('entryInvoices', JSON.stringify(data.sales151));
                entryInvoices = data.sales151;
            }
            
            // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ÛŒ ÙØ±ÙˆØ´ 151
            if (data.sales151 && Array.isArray(data.sales151)) {
                localStorage.setItem('salesInvoices151', JSON.stringify(data.sales151));
                salesInvoices151 = data.sales151;
            }
            
            // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ÛŒ ÙØ±ÙˆØ´ 168
            if (data.sales168 && Array.isArray(data.sales168)) {
                localStorage.setItem('salesInvoices168', JSON.stringify(data.sales168));
                salesInvoices168 = data.sales168;
            }
            
            // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ
            if (data.invoices && Array.isArray(data.invoices)) {
                // ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ Ø¯Ø± localStorage Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
                // Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø¨Ø±Ø§ÛŒ Ù†Ø³Ø®Ù‡â€ŒÙ‡Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡ Ø±Ø²Ø±Ùˆ Ø´Ø¯Ù‡ Ø§Ø³Øª
            }
            
            // Ø§ÛŒØ¬Ø§Ø¯ backup Ø®ÙˆØ¯Ú©Ø§Ø±
            autoBackup();
        }
        
        // ØªØ§Ø¨Ø¹ Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù…Ø­Ù„ÛŒ
        function createBackup() {
            const timestamp = new Date().toISOString();
            const backup = {
                products: products,
                entryInvoices: entryInvoices,
                salesInvoices151: salesInvoices151,
                salesInvoices168: salesInvoices168,
                backupDate: timestamp,
                version: '1.0'
            };
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage Ø¨Ø§ Ú©Ù„ÛŒØ¯ Ù…Ø®ØµÙˆØµ
            localStorage.setItem('elishoes_backup', JSON.stringify(backup));
            localStorage.setItem('elishoes_last_backup', timestamp);
            
            // Ù†Ù…Ø§ÛŒØ´ Ø§Ù†Ø¯Ø§Ø²Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†
            const backupSize = JSON.stringify(backup).length;
            const sizeKB = (backupSize / 1024).toFixed(2);
            
            showToast('Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù…Ø­Ù„ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯ (' + sizeKB + ' KB)');
            updateSystemInfo();
        }
        
        // ØªØ§Ø¨Ø¹ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
        function clearAllData() {
            if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª!')) {
                return;
            }
            
            if (!confirm('Ø§ÛŒÙ† Ø¢Ø®Ø±ÛŒÙ† Ù‡Ø´Ø¯Ø§Ø± Ø§Ø³Øª! ØªÙ…Ø§Ù… Ù…Ø­ØµÙˆÙ„Ø§Øª Ùˆ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ Ù¾Ø§Ú© Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø´Ø¯.')) {
                return;
            }
            
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
            localStorage.removeItem('products');
            localStorage.removeItem('entryInvoices');
            localStorage.removeItem('salesInvoices151');
            localStorage.removeItem('salesInvoices168');
            localStorage.removeItem('elishoes_backup');
            localStorage.removeItem('elishoes_last_backup');
            
            // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ù…ØªØºÛŒØ±Ù‡Ø§
            products = [];
            entryInvoices = [];
            salesInvoices151 = [];
            salesInvoices168 = [];
            tempEntryItems = [];
            tempSales151Items = [];
            tempSales168Items = [];
            editingInvoice = null;
            currentAddTarget = null;
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
            refreshInventory();
            renderEntryInvoices();
            renderSales151Invoices();
            renderSales168Invoices();
            updateSystemInfo();
            
            showToast('Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯');
        }
        
        // ØªØ§Ø¨Ø¹ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ…
        function updateSystemInfo() {
            const lastSave = localStorage.getItem('elishoes_last_backup') || 'Ù†Ø§Ù…Ø´Ø®Øµ';
            
            document.getElementById('total-products-info').textContent = products.length;
            document.getElementById('entry-invoices-count').textContent = entryInvoices.length;
            document.getElementById('sales151-invoices-count').textContent = salesInvoices151.length;
            document.getElementById('sales168-invoices-count').textContent = salesInvoices168.length;
            document.getElementById('last-save-time').textContent = lastSave;
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ
            let totalSize = 0;
            const keys = ['products', 'entryInvoices', 'salesInvoices151', 'salesInvoices168', 'elishoes_backup'];
            keys.forEach(key => {
                const item = localStorage.getItem(key);
                if (item) totalSize += item.length;
            });
            
            const sizeKB = (totalSize / 1024).toFixed(2);
            document.getElementById('storage-size').textContent = `${sizeKB} KB`;
        }
        
        // ========== ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø§Ø¨Ø±ÛŒ ==========
        
        // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø§Ø¨Ø±ÛŒ
        function setupCloudSync() {
            alert('Ù„Ø·ÙØ§Ù‹ ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:\n\n' +
                  'ğŸ”¥ Firebase: Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ú¯ÙˆÚ¯Ù„ (Ø±Ø§ÛŒÚ¯Ø§Ù†)\n' +
                  'âš¡ Supabase: Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù…ØªÙ†â€ŒØ¨Ø§Ø² Firebase\n' +
                  'ğŸ“± GitHub: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² GitHub Gist\n' +
                  'ğŸ’¾ LocalStorage Enhanced: Ø¨Ù‡Ø¨ÙˆØ¯ localStorage');
        }
        
        // ØªÙ†Ø¸ÛŒÙ… Firebase
        function setupFirebase() {
            const message = `Ø¨Ø±Ø§ÛŒ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Firebase:

1. Ø¨Ù‡ https://console.firebase.google.com Ø¨Ø±ÙˆÛŒØ¯
2. Ù¾Ø±ÙˆÚ˜Ù‡ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯
3. Firestore Database ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯
4. API Key Ùˆ config Ø±Ø§ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯
5. Ú©Ø¯ Firebase SDK Ø±Ø§ Ø¨Ù‡ Ø§ÛŒÙ† Ù¾Ø±ÙˆÚ˜Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯

Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ø§Ù…Ù„ Firebase Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯ØŸ`;
            
            if (confirm(message)) {
                window.open('https://firebase.google.com/docs/firestore/quickstart', '_blank');
            }
        }
        
        // ØªÙ†Ø¸ÛŒÙ… Supabase
        function setupSupabase() {
            const message = `Ø¨Ø±Ø§ÛŒ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Supabase:

1. Ø¨Ù‡ https://supabase.com Ø¨Ø±ÙˆÛŒØ¯
2. Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯
3. Ù¾Ø±ÙˆÚ˜Ù‡ Ø¬Ø¯ÛŒØ¯ Ø¨Ø³Ø§Ø²ÛŒØ¯
4. Table Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯ Ø¨Ø§ Ù†Ø§Ù… 'elishoes_data'
5. API URL Ùˆ anon key Ø±Ø§ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯

Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ø§Ù…Ù„ Supabase Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯ØŸ`;
            
            if (confirm(message)) {
                window.open('https://supabase.com/docs/guides/getting-started/quickstarts/js', '_blank');
            }
        }
        
        // ØªÙ†Ø¸ÛŒÙ… GitHub
        function setupGitHub() {
            const savedConfig = localStorage.getItem('elishoes_cloud_sync');
            
            // Ø§Ú¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù‚Ø¨Ù„ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ø´Ø¯ØŒ ÙÙ‚Ø· ØªØ³Øª Ú©Ù†
            if (savedConfig) {
                const config = JSON.parse(savedConfig);
                if (config.enabled && config.provider === 'github' && config.config) {
                    // ØªØ³Øª Ø§ØªØµØ§Ù„ Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…ÙˆØ¬ÙˆØ¯
                    testGitHubConnection(config.config.token, config.config.gistId);
                    return;
                }
            }
            
            // Ø§Ú¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù†Ø¨Ø§Ø´Ø¯ØŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¬Ø¯ÛŒØ¯ Ú©Ù†
            // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Personal Access Token
            const token = prompt('Ù„Ø·ÙØ§Ù‹ Personal Access Token Ø§Ø² GitHub Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:\n\nØ±Ø§Ù‡Ù†Ù…Ø§:\n1. Ø¨Ù‡ github.com Ø¨Ø±ÙˆÛŒØ¯\n2. Settings â†’ Developer settings â†’ Personal access tokens\n3. Generate new token (classic)\n4. scopes: gist Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯\n5. Token Ø±Ø§ Ú©Ù¾ÛŒ Ùˆ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯\n\nğŸ’¡ Ù†Ú©ØªÙ‡: Ø§Ú¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù‚Ø¨Ù„ÛŒ Ø¯Ø§Ø±ÛŒØ¯ØŒ Ú©Ù„ÛŒØ¯ Cancel Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯');
            
            if (!token) {
                showToast('Ø¹Ù…Ù„ÛŒØ§Øª Ù„ØºÙˆ Ø´Ø¯. Ø§Ú¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù‚Ø¨Ù„ÛŒ Ø¯Ø§Ø±ÛŒØ¯ØŒ Ø§Ø² Ø¯Ú©Ù…Ù‡ "ğŸ”„ ØªØ³Øª Ø§ØªØµØ§Ù„ GitHub" Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯', 'info');
                return;
            }
            
            // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Gist ID
            const gistId = prompt('Ù„Ø·ÙØ§Ù‹ ID Ú¯ÛŒØ³Øª GitHub Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:\n\nØ±Ø§Ù‡Ù†Ù…Ø§:\n1. gist.github.com Ø¨Ø±ÙˆÛŒØ¯\n2. Ú¯ÛŒØ³Øª Ø¬Ø¯ÛŒØ¯ Ø¨Ø³Ø§Ø²ÛŒØ¯ ÛŒØ§ Ú¯ÛŒØ³Øª Ù…ÙˆØ¬ÙˆØ¯ Ø±Ø§ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯\n3. URL Ú¯ÛŒØ³Øª Ø±Ø§ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ù„: https://gist.github.com/username/abc123def456)\n4. ID Ú¯ÛŒØ³Øª (abc123def456) Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
            
            if (!gistId) return;
            
            // ØªØ³Øª Ø§ØªØµØ§Ù„
            testGitHubConnection(token, gistId);
        }
        
        // ØªØ§Ø¨Ø¹ ØªØ³Øª Ø§ØªØµØ§Ù„ GitHub Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…ÙˆØ¬ÙˆØ¯
        function testGitHubConnectionWithSavedConfig() {
            const savedConfig = localStorage.getItem('elishoes_cloud_sync');
            
            if (!savedConfig) {
                alert('Ø§Ø¨ØªØ¯Ø§ GitHub Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯');
                return;
            }
            
            const config = JSON.parse(savedConfig);
            if (!config.enabled || config.provider !== 'github' || !config.config) {
                alert('ØªÙ†Ø¸ÛŒÙ…Ø§Øª GitHub Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯');
                return;
            }
            
            showToast('Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª Ø§ØªØµØ§Ù„...', 'info');
            testGitHubConnection(config.config.token, config.config.gistId);
        }
        
        // ØªØ³Øª Ø§ØªØµØ§Ù„ Ú¯ÛŒØª Ù‡Ø§Ø¨
        function testGitHubConnection(token, gistId) {
            fetch(`https://api.github.com/gists/${gistId}`, {
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error(`Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„: ${response.status} ${response.statusText}`);
                }
            })
            .then(gist => {
                // Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                cloudSync.enabled = true;
                cloudSync.provider = 'github';
                cloudSync.config = {
                    token: token,
                    gistId: gistId,
                    username: gist.owner?.login || 'Unknown'
                };
                cloudSync.lastSync = new Date().toISOString();
                
                localStorage.setItem('elishoes_cloud_sync', JSON.stringify(cloudSync));
                updateSyncStatus();
                
                // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆÙÙ‚ÛŒØª
                const message = `âœ… Ø§ØªØµØ§Ù„ GitHub Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø±Ù‚Ø±Ø§Ø± Ø´Ø¯!

ğŸ‘¤ Ú©Ø§Ø±Ø¨Ø±: ${gist.owner?.login || 'Unknown'}
ğŸ“ Ù†Ø§Ù… Ú¯ÛŒØ³Øª: ${gist.description || 'Ø¨Ø¯ÙˆÙ† ØªÙˆØ¶ÛŒØ­Ø§Øª'}
ğŸ”— Ú¯ÛŒØ³Øª ID: ${gistId}

Ø­Ø§Ù„Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯.`;
                
                showToast(message, 'success');
                updateSyncStatus();
            })
            .catch(error => {
                console.error('GitHub connection error:', error);
                alert(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ GitHub:\n\n${error.message}\n\nÙ„Ø·ÙØ§Ù‹ Token Ùˆ Gist ID Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯ Ùˆ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.`);
            });
        }
        
        // Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¨Ù‡ Ú¯ÛŒØª Ù‡Ø§Ø¨
        function syncToGitHub() {
            if (!cloudSync.enabled || cloudSync.provider !== 'github') {
                alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ GitHub Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯');
                return;
            }
            
            const config = cloudSync.config;
            if (!config || !config.token || !config.gistId) {
                alert('ØªÙ†Ø¸ÛŒÙ…Ø§Øª GitHub Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯.');
                return;
            }
            
            // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
            const data = {
                elishoes_data: {
                    inventory: getInventory(),
                    sales151: getSales151(),
                    sales168: getSales168(),
                    invoices: getAllInvoices(),
                    lastUpdated: new Date().toISOString(),
                    version: '1.0'
                }
            };
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú¯ÛŒØ³Øª ÙØ¹Ù„ÛŒ
            fetch(`https://api.github.com/gists/${config.gistId}`, {
                headers: {
                    'Authorization': `token ${config.token}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú¯ÛŒØ³Øª: ${response.status}`);
                }
                return response.json();
            })
            .then(gist => {
                // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú¯ÛŒØ³Øª
                const updatedGist = {
                    description: 'EliShoes - Backup of inventory and sales data',
                    files: {
                        'elishoes_data.json': {
                            content: JSON.stringify(data, null, 2)
                        }
                    }
                };
                
                return fetch(`https://api.github.com/gists/${config.gistId}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `token ${config.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updatedGist)
                });
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Ø®Ø·Ø§ Ø¯Ø± Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ: ${response.status}`);
                }
                return response.json();
            })
            .then(result => {
                cloudSync.lastSync = new Date().toISOString();
                localStorage.setItem('elishoes_cloud_sync', JSON.stringify(cloudSync));
                updateSyncStatus();
                
                showToast('âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø± GitHub Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù†Ø¯', 'success');
            })
            .catch(error => {
                console.error('GitHub sync error:', error);
                alert(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ:\n\n${error.message}\n\nÙ„Ø·ÙØ§Ù‹ Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª Ùˆ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.`);
            });
        }
        
        // Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø§Ø² Ú¯ÛŒØª Ù‡Ø§Ø¨
        function syncFromGitHub() {
            if (!cloudSync.enabled || cloudSync.provider !== 'github') {
                alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ GitHub Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯');
                return;
            }
            
            const config = cloudSync.config;
            if (!config || !config.token || !config.gistId) {
                alert('ØªÙ†Ø¸ÛŒÙ…Ø§Øª GitHub Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯.');
                return;
            }
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø² Ú¯ÛŒØª
            fetch(`https://api.github.com/gists/${config.gistId}`, {
                headers: {
                    'Authorization': `token ${config.token}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú¯ÛŒØ³Øª: ${response.status}`);
                }
                return response.json();
            })
            .then(gist => {
                const dataFile = gist.files['elishoes_data.json'];
                if (!dataFile) {
                    throw new Error('ÙØ§ÛŒÙ„ Ø¯Ø§Ø¯Ù‡ Ø¯Ø± Ú¯ÛŒØ³Øª ÛŒØ§ÙØª Ù†Ø´Ø¯');
                }
                
                // Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ø­ØªÙˆØ§ÛŒ ÙØ§ÛŒÙ„
                return fetch(dataFile.raw_url);
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§');
                }
                return response.json();
            })
            .then(data => {
                if (!data.elishoes_data) {
                    throw new Error('ÙØ±Ù…Øª Ø¯Ø§Ø¯Ù‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
                }
                
                // Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                restoreFromData(data.elishoes_data);
                
                cloudSync.lastSync = new Date().toISOString();
                localStorage.setItem('elishoes_cloud_sync', JSON.stringify(cloudSync));
                updateSyncStatus();
                
                // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø±Ø§Ø¨Ø·
                refreshInventory();
                renderEntryInvoices();
                renderSales151Invoices();
                renderSales168Invoices();
                updateProductSelects();
                updateSystemInfo();
                
                showToast('âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² GitHub Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯Ù†Ø¯', 'success');
            })
            .catch(error => {
                console.error('GitHub sync error:', error);
                alert(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ:\n\n${error.message}\n\nÙ„Ø·ÙØ§Ù‹ Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª Ùˆ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.`);
            });
        }
        
        // Ø¨Ù‡Ø¨ÙˆØ¯ LocalStorage
        function setupLocalStorageBackup() {
            // ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ backup Ø®ÙˆØ¯Ú©Ø§Ø±
            autoBackupConfig.enabled = true;
            autoBackupConfig.lastBackup = new Date().toISOString();
            
            // Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
            localStorage.setItem('elishoes_autobackup', JSON.stringify(autoBackupConfig));
            
            // Ø´Ø±ÙˆØ¹ backup Ø®ÙˆØ¯Ú©Ø§Ø±
            setInterval(() => {
                if (autoBackupConfig.enabled) {
                    createBackup();
                }
            }, autoBackupConfig.interval);
            
            cloudSync.enabled = true;
            cloudSync.provider = 'localStorage';
            cloudSync.lastSync = new Date().toISOString();
            
            localStorage.setItem('elishoes_cloud_sync', JSON.stringify(cloudSync));
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ status
            updateSyncStatus();
            showToast('Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± ÙØ¹Ø§Ù„ Ø´Ø¯ (Ù‡Ø± Ø³Ø§Ø¹Øª)');
        }
        
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ
        function updateSyncStatus() {
            const statusEl = document.getElementById('sync-status');
            const githubSection = document.getElementById('github-sync-section');
            const savedConfig = localStorage.getItem('elishoes_cloud_sync');
            
            if (savedConfig) {
                const config = JSON.parse(savedConfig);
                if (config.enabled && config.provider) {
                    statusEl.className = 'sync-status online';
                    statusEl.textContent = 'ÙˆØ¶Ø¹ÛŒØª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ: Ø¢Ù†Ù„Ø§ÛŒÙ† (' + getProviderName(config.provider) + ')';
                    
                    // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ GitHub Ø§Ú¯Ø± GitHub ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
                    if (config.provider === 'github' && config.config) {
                        githubSection.style.display = 'block';
                    } else {
                        githubSection.style.display = 'none';
                    }
                    return;
                }
            }
            
            statusEl.className = 'sync-status offline';
            statusEl.textContent = 'ÙˆØ¶Ø¹ÛŒØª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ: Ø¢ÙÙ„Ø§ÛŒÙ† (ÙÙ‚Ø· LocalStorage)';
            githubSection.style.display = 'none';
        }
        
        // Ù†Ø§Ù… Ø§Ø±Ø§Ø¦Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡
        function getProviderName(provider) {
            const names = {
                'firebase': 'Firebase',
                'supabase': 'Supabase',
                'github': 'GitHub',
                'localStorage': 'LocalStorage Enhanced'
            };
            return names[provider] || provider;
        }
        
        // ========== Ù¾Ø§ÛŒØ§Ù† Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡ ==========
        
        // ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ ØªØ¨
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'inventory') {
                refreshInventory();
            } else if (tabName === 'entry') {
                updateEntryProductSelect();
            } else if (tabName === 'sales151' || tabName === 'sales168') {
                updateProductSelects();
            } else if (tabName === 'data-management') {
                updateSystemInfo();
                updateSyncStatus();
            }
        }

        // ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ ÙØ§Ú©ØªÙˆØ± (Ù…Ø¹Ù…ÙˆÙ„ÛŒ ÛŒØ§ Ù‚Ø§Ø¨Ù„ ÙˆÛŒØ±Ø§ÛŒØ´)
        function renderInvoiceItems(items, type, invoiceIndex) {
            if (editingInvoice?.type === type && editingInvoice?.index === invoiceIndex) {
                // Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´
                return items.map((item, itemIndex) => `
                    <div class="invoice-item">
                        <div class="invoice-item-edit">
                            <span>${item.name} - ${item.color}</span>
                            <input type="number" min="1" value="${item.quantity}" 
                                   id="edit-${type}-${invoiceIndex}-${itemIndex}" 
                                   onchange="validateEditQuantity('${type}', ${invoiceIndex}, ${itemIndex}, this.value)">
                            <span>Ø¹Ø¯Ø¯</span>
                            <button class="btn btn-danger" onclick="removeInvoiceItem('${type}', ${invoiceIndex}, ${itemIndex})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                        </div>
                    </div>
                `).join('');
            } else {
                // Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´
                return items.map(item => `
                    <div class="invoice-item">
                        <div class="invoice-item-view">
                            <span>${item.name} - ${item.color}</span>
                            <span>${item.quantity} Ø¹Ø¯Ø¯</span>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ±ÙˆØ¯ÛŒ
        function addEntry(targetInvoiceId = null) {
            const select = document.getElementById('entry-product-select').value;
            const name = document.getElementById('entry-product-name').value.trim();
            const color = document.getElementById('entry-product-color').value.trim();
            const quantity = parseInt(document.getElementById('entry-quantity').value);
            const invoiceDate = document.getElementById('entry-invoice-date').value || new Date().toISOString().split('T')[0];

            if (!name || !color || quantity <= 0) {
                showToast('Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯', 'error');
                return;
            }

            // Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ¬ÙˆØ¯
            let product = products.find(p => p.name === name && p.color === color);
            
            if (!product) {
                // Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯
                product = {
                    id: Date.now(),
                    name: name,
                    color: color,
                    entry: 0,
                    sales151: 0,
                    sales168: 0
                };
                products.push(product);
                // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¯Ø± ÙØ±Ù…
                updateEntryProductSelect();
            }

            // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² targetInvoiceId Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡ ÛŒØ§ currentAddTarget
            const invoiceId = targetInvoiceId || (currentAddTarget?.type === 'entry' ? currentAddTarget.invoiceId : null);
            
            if (invoiceId) {
                // Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ ÙØ§Ú©ØªÙˆØ± Ù…ÙˆØ¬ÙˆØ¯
                const invoice = entryInvoices.find(inv => inv.id == invoiceId);
                if (invoice) {
                    invoice.items.push({
                        name: name,
                        color: color,
                        quantity: quantity
                    });
                    
                    // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
                    const prod = products.find(p => p.name === name && p.color === color);
                    if (prod) {
                        prod.entry += quantity;
                    }
                    
                    // Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
                    localStorage.setItem('entryInvoices', JSON.stringify(entryInvoices));
                    localStorage.setItem('products', JSON.stringify(products));
                    
                    // backup Ø®ÙˆØ¯Ú©Ø§Ø±
                    autoBackup();
                    
                    // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
                    clearEntryForm();
                    updateEntryProductSelect();
                    
                    // Ø±Ù†Ø¯Ø± Ù…Ø¬Ø¯Ø¯
                    renderEntryInvoices();
                    refreshInventory();
                    updateProductSelects();
                    
                    showToast('Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ ÙØ§Ú©ØªÙˆØ± Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
                } else {
                    showToast('ÙØ§Ú©ØªÙˆØ± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
                }
            } else {
                // Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ù„ÛŒØ³Øª Ù…ÙˆÙ‚Øª (Ø¨Ø±Ø§ÛŒ ÙØ§Ú©ØªÙˆØ± Ø¬Ø¯ÛŒØ¯)
                tempEntryItems.push({
                    productId: product.id,
                    name: name,
                    color: color,
                    quantity: quantity,
                    invoiceDate: invoiceDate  // Ø°Ø®ÛŒØ±Ù‡ ØªØ§Ø±ÛŒØ® Ø¯Ø± Ø¢ÛŒØªÙ… Ù…ÙˆÙ‚Øª
                });

                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
                clearEntryForm();
                updateEntryProductSelect();

                // Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª Ù…ÙˆÙ‚Øª
                document.getElementById('entry-temp-list').classList.remove('hidden');
                renderTempEntryItems();

                showToast('Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ Ù„ÛŒØ³Øª ÙˆØ±ÙˆØ¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
            }
        }

        function renderTempEntryItems() {
            const tbody = document.getElementById('entry-temp-body');
            tbody.innerHTML = tempEntryItems.map((item, index) => `
                <tr>
                    <td>${item.name}</td>
                    <td>${item.color}</td>
                    <td>${item.quantity}</td>
                    <td>${item.invoiceDate || new Date().toLocaleDateString('fa-IR')}</td>
                    <td><button class="btn btn-danger" onclick="removeTempEntryItem(${index})">ğŸ—‘ï¸ Ø­Ø°Ù</button></td>
                </tr>
            `).join('');
        }

        function removeTempEntryItem(index) {
            tempEntryItems.splice(index, 1);
            if (tempEntryItems.length === 0) {
                document.getElementById('entry-temp-list').classList.add('hidden');
            } else {
                renderTempEntryItems();
            }
        }

        function saveEntry() {
            if (tempEntryItems.length === 0) return;

            // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªØ§Ø±ÛŒØ® Ø§ÙˆÙ„ÛŒÙ† Ø¢ÛŒØªÙ… (Ú†ÙˆÙ† Ù‡Ù…Ù‡ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ Ø¨Ø§ÛŒØ¯ Ù‡Ù…Ø§Ù† ØªØ§Ø±ÛŒØ® Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù†Ø¯)
            const invoiceDate = tempEntryItems[0].invoiceDate || new Date().toISOString().split('T')[0];
            
            const invoice = {
                id: Date.now(),
                date: invoiceDate,  // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªØ§Ø±ÛŒØ® Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
                items: tempEntryItems.map(item => ({
                    name: item.name,
                    color: item.color,
                    quantity: item.quantity
                }))
            };

            entryInvoices.push(invoice);
            localStorage.setItem('entryInvoices', JSON.stringify(entryInvoices));

            // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª
            tempEntryItems.forEach(item => {
                const product = products.find(p => p.id === item.productId);
                if (product) {
                    product.entry += item.quantity;
                }
            });

            localStorage.setItem('products', JSON.stringify(products));
            
            // backup Ø®ÙˆØ¯Ú©Ø§Ø±
            autoBackup();

            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª Ù…ÙˆÙ‚Øª
            tempEntryItems = [];
            document.getElementById('entry-temp-list').classList.add('hidden');

            renderEntryInvoices();
            showToast('ÙØ§Ú©ØªÙˆØ± ÙˆØ±ÙˆØ¯ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');

            // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ select Ø¯Ø± ØªØ¨â€ŒÙ‡Ø§ÛŒ ÙØ±ÙˆØ´
            updateProductSelects();
        }

        function cancelEntry() {
            tempEntryItems = [];
            document.getElementById('entry-temp-list').classList.add('hidden');
            clearEntryForm();
            updateEntryProductSelect();
        }

        function renderEntryInvoices() {
            const container = document.getElementById('entry-invoices');
            if (entryInvoices.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Ù‡ÛŒÚ† ÙØ§Ú©ØªÙˆØ± ÙˆØ±ÙˆØ¯ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>';
                return;
            }

            container.innerHTML = entryInvoices.map((invoice, index) => `
                <div class="invoice-card">
                    <div class="invoice-header">
                        <div>
                            <strong>ÙØ§Ú©ØªÙˆØ± ÙˆØ±ÙˆØ¯ÛŒ #${invoice.id}</strong>
                            ${editingInvoice?.type === 'entry' && editingInvoice?.index === index ? 
                                `<input type="date" id="edit-invoice-date-${type}-${index}" value="${invoice.date}" style="margin-right: 10px; padding: 5px;">` :
                                `<span class="invoice-date">${new Date(invoice.date).toLocaleDateString('fa-IR')}</span>`
                            }
                        </div>
                        <div class="invoice-actions">
                            ${editingInvoice?.type === 'entry' && editingInvoice?.index === index ? 
                                `<button class="btn btn-success" onclick="saveInvoiceEdit()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡</button>
                                 <button class="btn btn-secondary" onclick="cancelInvoiceEdit()">âŒ Ù„ØºÙˆ</button>
                                 <button class="btn btn-info" onclick="addItemToInvoice('entry', ${index})">â• Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„</button>` :
                                `<button class="btn btn-secondary" onclick="editInvoice(\'entry\', ${index})">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´</button>
                                 <button class="btn btn-danger" onclick="deleteInvoice('entry', ${index})">ğŸ—‘ï¸ Ø­Ø°Ù ÙØ§Ú©ØªÙˆØ±</button>`
                            }
                        </div>
                    </div>
                    <div class="invoice-items" id="entry-invoice-${index}">
                        ${renderInvoiceItems(invoice.items, 'entry', index)}
                    </div>
                </div>
            `).join('');
        }

        // ØªÙˆØ§Ø¨Ø¹ ÙˆÛŒØ±Ø§ÛŒØ´ ÙØ§Ú©ØªÙˆØ±
        function editInvoice(type, index) {
            // Ù„ØºÙˆ ÙˆÛŒØ±Ø§ÛŒØ´ Ù‚Ø¨Ù„ÛŒ Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
            if (editingInvoice) {
                cancelInvoiceEdit();
            }
            
            editingInvoice = { type, index };
            
            // Ø±Ù†Ø¯Ø± Ù…Ø¬Ø¯Ø¯ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´
            if (type === 'entry') {
                renderEntryInvoices();
            } else if (type === 'sales151') {
                renderSales151Invoices();
            } else if (type === 'sales168') {
                renderSales168Invoices();
            }
        }

        function cancelInvoiceEdit() {
            editingInvoice = null;
            renderEntryInvoices();
            renderSales151Invoices();
            renderSales168Invoices();
        }

        function saveInvoiceEdit() {
            if (!editingInvoice) return;

            const { type, index } = editingInvoice;
            let invoice;
            
            if (type === 'entry') {
                invoice = entryInvoices[index];
            } else if (type === 'sales151') {
                invoice = salesInvoices151[index];
            } else if (type === 'sales168') {
                invoice = salesInvoices168[index];
            }

            if (!invoice) return;

            // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ§Ø±ÛŒØ®
            const dateInput = document.getElementById(`edit-invoice-date-${type}-${index}`);
            if (dateInput) {
                invoice.date = dateInput.value || invoice.date;
            }

            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙØ±ÙˆØ´ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
            if (type === 'sales151' || type === 'sales168') {
                for (let itemIndex = 0; itemIndex < invoice.items.length; itemIndex++) {
                    const item = invoice.items[itemIndex];
                    const newQuantity = parseInt(document.getElementById(`edit-${type}-${index}-${itemIndex}`).value) || item.quantity;
                    
                    if (newQuantity > 0) {
                        const product = products.find(p => p.name === item.name && p.color === item.color);
                        if (product) {
                            const currentStock = getStock(product);
                            if (newQuantity > currentStock + item.quantity) {
                                showToast(`Ù…ÙˆØ¬ÙˆØ¯ÛŒ ${item.name} - ${item.color} Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª`, 'error');
                                return;
                            }
                        }
                    }
                }
            }

            // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ Ø§Ø² ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´
            invoice.items = invoice.items.map((item, itemIndex) => {
                const input = document.getElementById(`edit-${type}-${index}-${itemIndex}`);
                if (input) {
                    return {
                        ...item,
                        quantity: parseInt(input.value) || item.quantity
                    };
                }
                return item;
            }).filter(item => item.quantity > 0);

            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage
            if (type === 'entry') {
                localStorage.setItem('entryInvoices', JSON.stringify(entryInvoices));
            } else if (type === 'sales151') {
                localStorage.setItem('salesInvoices151', JSON.stringify(salesInvoices151));
            } else if (type === 'sales168') {
                localStorage.setItem('salesInvoices168', JSON.stringify(salesInvoices168));
            }
            
            // backup Ø®ÙˆØ¯Ú©Ø§Ø±
            autoBackup();

            // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª
            updateProductQuantities(type, index);

            // Ù„ØºÙˆ ÙˆÛŒØ±Ø§ÛŒØ´ Ùˆ Ø±Ù†Ø¯Ø± Ù…Ø¬Ø¯Ø¯
            editingInvoice = null;
            renderEntryInvoices();
            renderSales151Invoices();
            renderSales168Invoices();
            refreshInventory();
            updateProductSelects();

            showToast('ÙØ§Ú©ØªÙˆØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯');
        }

        function removeInvoiceItem(type, invoiceIndex, itemIndex) {
            let invoices;
            if (type === 'entry') {
                invoices = entryInvoices;
            } else if (type === 'sales151') {
                invoices = salesInvoices151;
            } else if (type === 'sales168') {
                invoices = salesInvoices168;
            }

            if (!invoices || !invoices[invoiceIndex]) return;

            invoices[invoiceIndex].items.splice(itemIndex, 1);

            // Ø§Ú¯Ø± ÙØ§Ú©ØªÙˆØ± Ø®Ø§Ù„ÛŒ Ø´Ø¯ØŒ Ø¢Ù† Ø±Ø§ Ø­Ø°Ù Ú©Ù†
            if (invoices[invoiceIndex].items.length === 0) {
                invoices.splice(invoiceIndex, 1);
            }

            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage
            if (type === 'entry') {
                localStorage.setItem('entryInvoices', JSON.stringify(entryInvoices));
            } else if (type === 'sales151') {
                localStorage.setItem('salesInvoices151', JSON.stringify(salesInvoices151));
            } else if (type === 'sales168') {
                localStorage.setItem('salesInvoices168', JSON.stringify(salesInvoices168));
            }
            
            // backup Ø®ÙˆØ¯Ú©Ø§Ø±
            autoBackup();

            // Ø±Ù†Ø¯Ø± Ù…Ø¬Ø¯Ø¯
            renderEntryInvoices();
            renderSales151Invoices();
            renderSales168Invoices();
            refreshInventory();
            updateProductSelects();

            showToast('Ø¢ÛŒØªÙ… Ø§Ø² ÙØ§Ú©ØªÙˆØ± Ø­Ø°Ù Ø´Ø¯');
        }

        function deleteInvoice(type, invoiceIndex) {
            if (!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† ÙØ§Ú©ØªÙˆØ± Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ')) {
                return;
            }

            let invoices;
            if (type === 'entry') {
                invoices = entryInvoices;
            } else if (type === 'sales151') {
                invoices = salesInvoices151;
            } else if (type === 'sales168') {
                invoices = salesInvoices168;
            }

            if (!invoices || !invoices[invoiceIndex]) return;

            // Ø­Ø°Ù ÙØ§Ú©ØªÙˆØ±
            invoices.splice(invoiceIndex, 1);

            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage
            if (type === 'entry') {
                localStorage.setItem('entryInvoices', JSON.stringify(entryInvoices));
            } else if (type === 'sales151') {
                localStorage.setItem('salesInvoices151', JSON.stringify(salesInvoices151));
            } else if (type === 'sales168') {
                localStorage.setItem('salesInvoices168', JSON.stringify(salesInvoices168));
            }
            
            // backup Ø®ÙˆØ¯Ú©Ø§Ø±
            autoBackup();

            // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª
            updateProductQuantities();

            // Ù„ØºÙˆ ÙˆÛŒØ±Ø§ÛŒØ´ Ùˆ Ø±Ù†Ø¯Ø± Ù…Ø¬Ø¯Ø¯
            editingInvoice = null;
            renderEntryInvoices();
            renderSales151Invoices();
            renderSales168Invoices();
            refreshInventory();
            updateProductSelects();

            showToast('ÙØ§Ú©ØªÙˆØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯');
        }

        function addItemToInvoice(type, invoiceIndex) {
            // Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† ÙØ±Ù… Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ Ø¨Ø±Ø§ÛŒ ÙØ§Ú©ØªÙˆØ±
            const invoiceId = type === 'entry' ? 
                entryInvoices[invoiceIndex]?.id : 
                type === 'sales151' ? 
                salesInvoices151[invoiceIndex]?.id : 
                salesInvoices168[invoiceIndex]?.id;
            
            if (!invoiceId) {
                showToast('ÙØ§Ú©ØªÙˆØ± ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
                return;
            }

            // Ø§ÛŒØ¬Ø§Ø¯ Ù…ØªØºÛŒØ± Ø³Ø±Ø§Ø³Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù‡Ø¯Ù ÙØ¹Ù„ÛŒ
            currentAddTarget = { type, invoiceId };

            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† ÙØ±Ù… Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ Ù…Ù†Ø§Ø³Ø¨
            if (type === 'entry') {
                showAddProductForm('entry', invoiceId);
            } else if (type === 'sales151') {
                showAddProductForm('sales151', invoiceId);
            } else if (type === 'sales168') {
                showAddProductForm('sales168', invoiceId);
            }

            showToast('ÙØ±Ù… Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ Ø¨Ø§Ø² Ø´Ø¯ - Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¨Ù‡ Ø§ÛŒÙ† ÙØ§Ú©ØªÙˆØ± Ø§Ø¶Ø§ÙÙ‡ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø´Ø¯');
        }

        function showAddProductForm(type, targetInvoiceId = null) {
            // Ù„ØºÙˆ ÙˆÛŒØ±Ø§ÛŒØ´ ÙØ¹Ù„ÛŒ
            editingInvoice = null;

            // Ù†Ù…Ø§ÛŒØ´ ÙØ±Ù… Ù…Ù†Ø§Ø³Ø¨
            if (type === 'entry') {
                const form = document.getElementById('add-product-form-entry');
                if (form.style.display === 'none' || !form.style.display) {
                    form.style.display = 'block';
                    currentAddTarget = targetInvoiceId ? { type, invoiceId: targetInvoiceId } : null;
                } else {
                    form.style.display = 'none';
                    currentAddTarget = null;
                }
            } else if (type === 'sales151') {
                const form = document.getElementById('add-product-form-sales151');
                if (form.style.display === 'none' || !form.style.display) {
                    form.style.display = 'block';
                    currentAddTarget = targetInvoiceId ? { type, invoiceId: targetInvoiceId } : null;
                } else {
                    form.style.display = 'none';
                    currentAddTarget = null;
                }
            } else if (type === 'sales168') {
                const form = document.getElementById('add-product-form-sales168');
                if (form.style.display === 'none' || !form.style.display) {
                    form.style.display = 'block';
                    currentAddTarget = targetInvoiceId ? { type, invoiceId: targetInvoiceId } : null;
                } else {
                    form.style.display = 'none';
                    currentAddTarget = null;
                }
            }
        }

        function validateEditQuantity(type, invoiceIndex, itemIndex, value) {
            const quantity = parseInt(value);
            if (quantity < 1) {
                document.getElementById(`edit-${type}-${invoiceIndex}-${itemIndex}`).value = 1;
                showToast('ØªØ¹Ø¯Ø§Ø¯ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú©Ù…ØªØ± Ø§Ø² Û± Ø¨Ø§Ø´Ø¯', 'error');
            }
        }

        function updateProductQuantities(type, invoiceIndex) {
            // Ø¨Ø§Ø²Ø³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª
            products.forEach(product => {
                product.entry = 0;
                product.sales151 = 0;
                product.sales168 = 0;
            });

            // Ù…Ø­Ø§Ø³Ø¨Ù‡ ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§
            entryInvoices.forEach(invoice => {
                invoice.items.forEach(item => {
                    const product = products.find(p => p.name === item.name && p.color === item.color);
                    if (product) {
                        product.entry += item.quantity;
                    }
                });
            });

            // Ù…Ø­Ø§Ø³Ø¨Ù‡ ÙØ±ÙˆØ´ Û±ÛµÛ±
            salesInvoices151.forEach(invoice => {
                invoice.items.forEach(item => {
                    const product = products.find(p => p.name === item.name && p.color === item.color);
                    if (product) {
                        product.sales151 += item.quantity;
                    }
                });
            });

            // Ù…Ø­Ø§Ø³Ø¨Ù‡ ÙØ±ÙˆØ´ Û±Û¶Û¸
            salesInvoices168.forEach(invoice => {
                invoice.items.forEach(item => {
                    const product = products.find(p => p.name === item.name && p.color === item.color);
                    if (product) {
                        product.sales168 += item.quantity;
                    }
                });
            });

            localStorage.setItem('products', JSON.stringify(products));
        }

        
        // ========== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ==========
        
        // ØªØ§Ø¨Ø¹ backup Ø®ÙˆØ¯Ú©Ø§Ø±
        function autoBackup() {
            if (autoBackupConfig.enabled) {
                const now = new Date().getTime();
                const lastBackup = autoBackupConfig.lastBackup ? new Date(autoBackupConfig.lastBackup).getTime() : 0;
                
                if (now - lastBackup >= autoBackupConfig.interval) {
                    createBackup();
                    autoBackupConfig.lastBackup = now.toISOString();
                    localStorage.setItem('elishoes_autobackup', JSON.stringify(autoBackupConfig));
                }
            }
        }
        
        // ========== Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ±ÙˆØ¯ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª ==========
        function updateEntryProductSelect() {
            const select = document.getElementById('entry-product-select');
            
            const existingProducts = products.map(product => 
                `<option value="${product.id}">${product.name} - ${product.color} (Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ: ${getStock(product)})</option>`
            ).join('');
            
            select.innerHTML = '<option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ¬ÙˆØ¯ ÛŒØ§ Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯</option>' +
                              '<option value="new">â• Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯</option>' +
                              existingProducts;
        }

        function onEntryProductSelect() {
            const select = document.getElementById('entry-product-select');
            const productName = document.getElementById('entry-product-name');
            const productColor = document.getElementById('entry-product-color');
            
            if (select.value === 'new') {
                // Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯ - ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ø®Ø§Ù„ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
                productName.value = '';
                productColor.value = '';
                productName.focus();
            } else if (select.value) {
                // Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ¬ÙˆØ¯ - ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
                const product = products.find(p => p.id == select.value);
                if (product) {
                    productName.value = product.name;
                    productColor.value = product.color;
                    productName.focus();
                }
            }
        }

        function clearEntryForm() {
            document.getElementById('entry-product-select').value = '';
            document.getElementById('entry-product-name').value = '';
            document.getElementById('entry-product-color').value = '';
            document.getElementById('entry-quantity').value = '1';
            setDefaultInvoiceDate();
        }

        function setDefaultInvoiceDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const todayString = `${year}-${month}-${day}`;
            document.getElementById('entry-invoice-date').value = todayString;
        }
        
        // ========== Ù…Ø¯ÛŒØ±ÛŒØª ÙØ±ÙˆØ´ Û±ÛµÛ± ==========
        function updateProductSelects() {
            const select151 = document.getElementById('sales151-product');
            const select168 = document.getElementById('sales168-product');
            
            const options = products.map(product => 
                `<option value="${product.id}">${product.name} - ${product.color} (Ù…ÙˆØ¬ÙˆØ¯ÛŒ: ${getStock(product)})</option>`
            ).join('');

            select151.innerHTML = '<option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø­ØµÙˆÙ„</option>' + options;
            select168.innerHTML = '<option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø­ØµÙˆÙ„</option>' + options;
        }

        function getStock(product) {
            return product.entry - product.sales151 - product.sales168;
        }

        function updateStock151() {
            const productId = parseInt(document.getElementById('sales151-product').value);
            const product = products.find(p => p.id === productId);
            const stock = product ? getStock(product) : 0;
            document.getElementById('stock151').value = stock;
        }

        function updateStock168() {
            const productId = parseInt(document.getElementById('sales168-product').value);
            const product = products.find(p => p.id === productId);
            const stock = product ? getStock(product) : 0;
            document.getElementById('stock168').value = stock;
        }

        function addSales151(targetInvoiceId = null) {
            const productId = parseInt(document.getElementById('sales151-product').value);
            const quantity = parseInt(document.getElementById('sales151-quantity').value);
            const product = products.find(p => p.id === productId);

            if (!product || quantity <= 0) {
                showToast('Ù„Ø·ÙØ§Ù‹ Ù…Ø­ØµÙˆÙ„ Ùˆ ØªØ¹Ø¯Ø§Ø¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }

            const stock = getStock(product);
            if (quantity > stock) {
                showToast('Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª', 'error');
                return;
            }

            // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² targetInvoiceId Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡ ÛŒØ§ currentAddTarget
            const invoiceId = targetInvoiceId || (currentAddTarget?.type === 'sales151' ? currentAddTarget.invoiceId : null);
            
            if (invoiceId) {
                // Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ ÙØ§Ú©ØªÙˆØ± Ù…ÙˆØ¬ÙˆØ¯
                const invoice = salesInvoices151.find(inv => inv.id == invoiceId);
                if (invoice) {
                    invoice.items.push({
                        name: product.name,
                        color: product.color,
                        quantity: quantity
                    });
                    
                    // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
                    product.sales151 += quantity;
                    
                    // Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
                    localStorage.setItem('salesInvoices151', JSON.stringify(salesInvoices151));
                    localStorage.setItem('products', JSON.stringify(products));
                    
                    // backup Ø®ÙˆØ¯Ú©Ø§Ø±
                    autoBackup();
                    
                    // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
                    document.getElementById('sales151-product').value = '';
                    document.getElementById('stock151').value = '';
                    document.getElementById('sales151-quantity').value = '1';
                    
                    // Ø±Ù†Ø¯Ø± Ù…Ø¬Ø¯Ø¯
                    renderSales151Invoices();
                    refreshInventory();
                    updateProductSelects();
                    
                    showToast('Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ ÙØ§Ú©ØªÙˆØ± Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
                } else {
                    showToast('ÙØ§Ú©ØªÙˆØ± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
                }
            } else {
                // Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ù„ÛŒØ³Øª Ù…ÙˆÙ‚Øª (Ø¨Ø±Ø§ÛŒ ÙØ§Ú©ØªÙˆØ± Ø¬Ø¯ÛŒØ¯)
                tempSales151Items.push({
                    productId: productId,
                    name: product.name,
                    color: product.color,
                    quantity: quantity
                });

                document.getElementById('sales151-product').value = '';
                document.getElementById('stock151').value = '';
                document.getElementById('sales151-quantity').value = '1';

                document.getElementById('sales151-temp-list').classList.remove('hidden');
                renderTempSales151Items();

                showToast('Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ Ù„ÛŒØ³Øª ÙØ±ÙˆØ´ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
            }
        }

        function renderTempSales151Items() {
            const tbody = document.getElementById('sales151-temp-body');
            tbody.innerHTML = tempSales151Items.map((item, index) => `
                <tr>
                    <td>${item.name}</td>
                    <td>${item.color}</td>
                    <td>${item.quantity}</td>
                    <td><button class="btn btn-danger" onclick="removeTempSales151Item(${index})">ğŸ—‘ï¸ Ø­Ø°Ù</button></td>
                </tr>
            `).join('');
        }

        function removeTempSales151Item(index) {
            tempSales151Items.splice(index, 1);
            if (tempSales151Items.length === 0) {
                document.getElementById('sales151-temp-list').classList.add('hidden');
            } else {
                renderTempSales151Items();
            }
        }

        function saveSales151() {
            if (tempSales151Items.length === 0) return;

            const invoice = {
                id: Date.now(),
                date: new Date().toISOString(),
                items: [...tempSales151Items]
            };

            salesInvoices151.push(invoice);
            localStorage.setItem('salesInvoices151', JSON.stringify(salesInvoices151));

            // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª
            tempSales151Items.forEach(item => {
                const product = products.find(p => p.id === item.productId);
                if (product) {
                    product.sales151 += item.quantity;
                }
            });

            localStorage.setItem('products', JSON.stringify(products));
            
            // backup Ø®ÙˆØ¯Ú©Ø§Ø±
            autoBackup();

            tempSales151Items = [];
            document.getElementById('sales151-temp-list').classList.add('hidden');
            renderSales151Invoices();
            showToast('ÙØ§Ú©ØªÙˆØ± ÙØ±ÙˆØ´ Û±ÛµÛ± Ø«Ø¨Øª Ø´Ø¯');

            // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ select
            updateProductSelects();
        }

        function cancelSales151() {
            tempSales151Items = [];
            document.getElementById('sales151-temp-list').classList.add('hidden');
        }

        function renderSales151Invoices() {
            const container = document.getElementById('sales151-invoices');
            if (salesInvoices151.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Ù‡ÛŒÚ† ÙØ§Ú©ØªÙˆØ± ÙØ±ÙˆØ´ Û±ÛµÛ± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>';
                return;
            }

            container.innerHTML = salesInvoices151.map((invoice, index) => `
                <div class="invoice-card">
                    <div class="invoice-header">
                        <div>
                            <strong>ÙØ§Ú©ØªÙˆØ± ÙØ±ÙˆØ´ Û±ÛµÛ± #${invoice.id}</strong>
                            ${editingInvoice?.type === 'sales151' && editingInvoice?.index === index ? 
                                `<input type="date" id="edit-invoice-date-${type}-${index}" value="${invoice.date}" style="margin-right: 10px; padding: 5px;">` :
                                `<span class="invoice-date">${new Date(invoice.date).toLocaleDateString('fa-IR')}</span>`
                            }
                        </div>
                        <div class="invoice-actions">
                            ${editingInvoice?.type === 'sales151' && editingInvoice?.index === index ? 
                                `<button class="btn btn-success" onclick="saveInvoiceEdit()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡</button>
                                 <button class="btn btn-secondary" onclick="cancelInvoiceEdit()">âŒ Ù„ØºÙˆ</button>
                                 <button class="btn btn-info" onclick="addItemToInvoice('sales151', ${index})">â• Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„</button>` :
                                `<button class="btn btn-secondary" onclick="editInvoice(\'sales151\', ${index})">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´</button>
                                 <button class="btn btn-danger" onclick="deleteInvoice('sales151', ${index})">ğŸ—‘ï¸ Ø­Ø°Ù ÙØ§Ú©ØªÙˆØ±</button>`
                            }
                        </div>
                    </div>
                    <div class="invoice-items" id="sales151-invoice-${index}">
                        ${renderInvoiceItems(invoice.items, 'sales151', index)}
                    </div>
                </div>
            `).join('');
        }

        // Ù…Ø¯ÛŒØ±ÛŒØª ÙØ±ÙˆØ´ Û±Û¶Û¸
        function addSales168(targetInvoiceId = null) {
            const productId = parseInt(document.getElementById('sales168-product').value);
            const quantity = parseInt(document.getElementById('sales168-quantity').value);
            const product = products.find(p => p.id === productId);

            if (!product || quantity <= 0) {
                showToast('Ù„Ø·ÙØ§Ù‹ Ù…Ø­ØµÙˆÙ„ Ùˆ ØªØ¹Ø¯Ø§Ø¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }

            const stock = getStock(product);
            if (quantity > stock) {
                showToast('Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª', 'error');
                return;
            }

            // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² targetInvoiceId Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡ ÛŒØ§ currentAddTarget
            const invoiceId = targetInvoiceId || (currentAddTarget?.type === 'sales168' ? currentAddTarget.invoiceId : null);
            
            if (invoiceId) {
                // Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ ÙØ§Ú©ØªÙˆØ± Ù…ÙˆØ¬ÙˆØ¯
                const invoice = salesInvoices168.find(inv => inv.id == invoiceId);
                if (invoice) {
                    invoice.items.push({
                        name: product.name,
                        color: product.color,
                        quantity: quantity
                    });
                    
                    // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
                    product.sales168 += quantity;
                    
                    // Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
                    localStorage.setItem('salesInvoices168', JSON.stringify(salesInvoices168));
                    localStorage.setItem('products', JSON.stringify(products));
                    
                    // backup Ø®ÙˆØ¯Ú©Ø§Ø±
                    autoBackup();
                    
                    // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
                    document.getElementById('sales168-product').value = '';
                    document.getElementById('stock168').value = '';
                    document.getElementById('sales168-quantity').value = '1';
                    
                    // Ø±Ù†Ø¯Ø± Ù…Ø¬Ø¯Ø¯
                    renderSales168Invoices();
                    refreshInventory();
                    updateProductSelects();
                    
                    showToast('Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ ÙØ§Ú©ØªÙˆØ± Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
                } else {
                    showToast('ÙØ§Ú©ØªÙˆØ± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
                }
            } else {
                // Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ù„ÛŒØ³Øª Ù…ÙˆÙ‚Øª (Ø¨Ø±Ø§ÛŒ ÙØ§Ú©ØªÙˆØ± Ø¬Ø¯ÛŒØ¯)
                tempSales168Items.push({
                    productId: productId,
                    name: product.name,
                    color: product.color,
                    quantity: quantity
                });

                document.getElementById('sales168-product').value = '';
                document.getElementById('stock168').value = '';
                document.getElementById('sales168-quantity').value = '1';

                document.getElementById('sales168-temp-list').classList.remove('hidden');
                renderTempSales168Items();

                showToast('Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ Ù„ÛŒØ³Øª ÙØ±ÙˆØ´ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
            }
        }

        function renderTempSales168Items() {
            const tbody = document.getElementById('sales168-temp-body');
            tbody.innerHTML = tempSales168Items.map((item, index) => `
                <tr>
                    <td>${item.name}</td>
                    <td>${item.color}</td>
                    <td>${item.quantity}</td>
                    <td><button class="btn btn-danger" onclick="removeTempSales168Item(${index})">ğŸ—‘ï¸ Ø­Ø°Ù</button></td>
                </tr>
            `).join('');
        }

        function removeTempSales168Item(index) {
            tempSales168Items.splice(index, 1);
            if (tempSales168Items.length === 0) {
                document.getElementById('sales168-temp-list').classList.add('hidden');
            } else {
                renderTempSales168Items();
            }
        }

        function saveSales168() {
            if (tempSales168Items.length === 0) return;

            const invoice = {
                id: Date.now(),
                date: new Date().toISOString(),
                items: [...tempSales168Items]
            };

            salesInvoices168.push(invoice);
            localStorage.setItem('salesInvoices168', JSON.stringify(salesInvoices168));

            // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª
            tempSales168Items.forEach(item => {
                const product = products.find(p => p.id === item.productId);
                if (product) {
                    product.sales168 += item.quantity;
                }
            });

            localStorage.setItem('products', JSON.stringify(products));
            
            // backup Ø®ÙˆØ¯Ú©Ø§Ø±
            autoBackup();

            tempSales168Items = [];
            document.getElementById('sales168-temp-list').classList.add('hidden');
            renderSales168Invoices();
            showToast('ÙØ§Ú©ØªÙˆØ± ÙØ±ÙˆØ´ Û±Û¶Û¸ Ø«Ø¨Øª Ø´Ø¯');

            // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ select
            updateProductSelects();
        }

        function cancelSales168() {
            tempSales168Items = [];
            document.getElementById('sales168-temp-list').classList.add('hidden');
        }

        function renderSales168Invoices() {
            const container = document.getElementById('sales168-invoices');
            if (salesInvoices168.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Ù‡ÛŒÚ† ÙØ§Ú©ØªÙˆØ± ÙØ±ÙˆØ´ Û±Û¶Û¸ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>';
                return;
            }

            container.innerHTML = salesInvoices168.map((invoice, index) => `
                <div class="invoice-card">
                    <div class="invoice-header">
                        <div>
                            <strong>ÙØ§Ú©ØªÙˆØ± ÙØ±ÙˆØ´ Û±Û¶Û¸ #${invoice.id}</strong>
                            ${editingInvoice?.type === 'sales168' && editingInvoice?.index === index ? 
                                `<input type="date" id="edit-invoice-date-${type}-${index}" value="${invoice.date}" style="margin-right: 10px; padding: 5px;">` :
                                `<span class="invoice-date">${new Date(invoice.date).toLocaleDateString('fa-IR')}</span>`
                            }
                        </div>
                        <div class="invoice-actions">
                            ${editingInvoice?.type === 'sales168' && editingInvoice?.index === index ? 
                                `<button class="btn btn-success" onclick="saveInvoiceEdit()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡</button>
                                 <button class="btn btn-secondary" onclick="cancelInvoiceEdit()">âŒ Ù„ØºÙˆ</button>
                                 <button class="btn btn-info" onclick="addItemToInvoice('sales168', ${index})">â• Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„</button>` :
                                `<button class="btn btn-secondary" onclick="editInvoice(\'sales168\', ${index})">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´</button>
                                 <button class="btn btn-danger" onclick="deleteInvoice('sales168', ${index})">ğŸ—‘ï¸ Ø­Ø°Ù ÙØ§Ú©ØªÙˆØ±</button>`
                            }
                        </div>
                    </div>
                    <div class="invoice-items" id="sales168-invoice-${index}">
                        ${renderInvoiceItems(invoice.items, 'sales168', index)}
                    </div>
                </div>
            `).join('');
        }

        // Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¬Ø¯ÛŒØ¯
        function showAddProduct() {
            document.getElementById('add-product-form').classList.remove('hidden');
        }

        function hideAddProduct() {
            document.getElementById('add-product-form').classList.add('hidden');
            document.getElementById('new-product-name').value = '';
            document.getElementById('new-product-color').value = '';
        }

        function saveNewProduct() {
            const name = document.getElementById('new-product-name').value.trim();
            const color = document.getElementById('new-product-color').value.trim();

            if (!name || !color) {
                showToast('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ùˆ Ø±Ù†Ú¯ Ù…Ø­ØµÙˆÙ„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }

            // Ø¨Ø±Ø±Ø³ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ù†Ø¨ÙˆØ¯Ù†
            if (products.some(p => p.name === name && p.color === color)) {
                showToast('Ø§ÛŒÙ† Ù…Ø­ØµÙˆÙ„ Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ Ø§Ø³Øª', 'error');
                return;
            }

            const newProduct = {
                id: Date.now(),
                name: name,
                color: color,
                entry: 0,
                sales151: 0,
                sales168: 0
            };

            products.push(newProduct);
            localStorage.setItem('products', JSON.stringify(products));
            
            // backup Ø®ÙˆØ¯Ú©Ø§Ø±
            autoBackup();

            hideAddProduct();
            showToast('Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
            refreshInventory();
            updateProductSelects();
        }

        // Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ
        function refreshInventory() {
            const tbody = document.getElementById('inventory-body');
            if (products.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #666;">Ù‡ÛŒÚ† Ù…Ø­ØµÙˆÙ„ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</td></tr>';
                document.getElementById('total-products').textContent = '0';
                document.getElementById('total-stock').textContent = '0';
                document.getElementById('low-stock').textContent = '0';
                return;
            }

            let totalStock = 0;
            let lowStockCount = 0;

            tbody.innerHTML = products.map(product => {
                const stock = getStock(product);
                totalStock += stock;
                if (stock <= 5) lowStockCount++;

                const stockClass = stock <= 5 ? 'stock-low' : 'stock-ok';

                return `
                    <tr>
                        <td>${product.name}</td>
                        <td>${product.color}</td>
                        <td>${product.entry}</td>
                        <td>${product.sales151}</td>
                        <td>${product.sales168}</td>
                        <td class="${stockClass}">${stock}</td>
                    </tr>
                `;
            }).join('');

            // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø±
            document.getElementById('total-products').textContent = products.length;
            document.getElementById('total-stock').textContent = totalStock;
            document.getElementById('low-stock').textContent = lowStockCount;
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        function init() {
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª cloud sync
            const savedConfig = localStorage.getItem('elishoes_cloud_sync');
            if (savedConfig) {
                try {
                    cloudSync = { ...cloudSync, ...JSON.parse(savedConfig) };
                } catch (e) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª sync:', e);
                }
            }
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª auto backup
            const savedBackup = localStorage.getItem('elishoes_autobackup');
            if (savedBackup) {
                try {
                    autoBackupConfig = { ...autoBackupConfig, ...JSON.parse(savedBackup) };
                } catch (e) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª backup:', e);
                }
            }
            
            // Ø´Ø±ÙˆØ¹ backup Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ú¯Ø± ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ø¯
            if (autoBackupConfig.enabled) {
                setInterval(() => {
                    if (autoBackupConfig.enabled) {
                        createBackup();
                    }
                }, autoBackupConfig.interval);
            }
            
            renderEntryInvoices();
            renderSales151Invoices();
            renderSales168Invoices();
            updateProductSelects();
            updateEntryProductSelect();
            setDefaultInvoiceDate();  // ØªÙ†Ø¸ÛŒÙ… ØªØ§Ø±ÛŒØ® Ù¾ÛŒØ´â€ŒÙØ±Ø¶
            refreshInventory();
            updateSystemInfo();
            updateSyncStatus();
        }

        // Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡
        init();
    </script>
</body>
</html>